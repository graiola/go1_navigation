<?xml version="1.0" ?>
<launch>

    <!--  Set arguments -->
    <arg name="robot_name"     default="" />
    <arg name="world_name"     default="empty" />
    <arg name="mapping"        default="true"  />
    <arg name="type"           default="indoor" />
    <arg name="launch_lidar"   default="true"  />
    <arg name="global_frame"   default="map"   />
    <arg name="odom_frame"     default="odom"  />
    <arg name="base_frame"     default="base_footprint" />
    <arg name="scan_topic"     default="scan" />
    <arg name="lidar_topic"    default="rslidar_points"/>
    <arg name="imu_topic"      default="imu"/>
    <arg name="gps_topic"      default="gps/fix" />
    <arg name="depth_topic"    default="" />

    <!-- Nimbro args -->
    <arg name="nimbro"         default="false" />
    <arg name="target"         default="10.8.0.1" />
    <arg name="camera_topic"   default="" />
    <arg name="nimbro_params"  default="$(find go1_navigation)/params/nimbro" />

    <!-- Remap battery state -->
    <remap from="battery_state" to="$(arg robot_name)/battery_state"/>

    <!-- Send the robot urdf to parameter server -->
    <include file="$(find wolf_description_utils)/launch/upload.launch">
        <arg name="sensors"      value="true" />
        <arg name="robot_name"   value="$(arg robot_name)" />
        <arg name="robot_model"  value="go1" />
    </include>

    <!-- Activate rslidar driver (old version) -->
    <!-- <include file="$(find rslidar_pointcloud)/launch/rs_lidar_16.launch" if="$(arg launch_lidar)"/> -->

    <!-- Activate rslidar driver (new version) -->
    <node pkg="rslidar_sdk" name="rslidar_sdk_node" type="rslidar_sdk_node" output="screen" if="$(arg launch_lidar)">
      <param name="config_path" value="$(find go1_navigation)/params/rslidar/config.yaml"/>
    </node>

    <!-- Convert joint states to TF transforms for rviz, etc -->
    <node name="go1_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher" respawn="false" output="log">
        <remap from="joint_states" to="$(arg robot_name)/joint_states"/>
    </node>

    <!-- Launch navigation with nimbro network -->
    <group if="$(arg nimbro)">
	<include file="$(find wolf_navigation_utils)/launch/wolf_robot_navigation.launch">
                <arg name="robot_name"        value="$(arg robot_name)"/>
                <arg name="robot_model"       value="go1"/>
		<arg name="robot_params"      value="$(find go1_navigation)/params"/>
		<arg name="world_name"        value="$(arg world_name)" />
    		<arg name="global_frame"      value="$(arg global_frame)"/>
    		<arg name="odom_frame"        value="$(arg odom_frame)"/>
    		<arg name="base_frame"        value="$(arg base_frame)"/>
    		<arg name="scan_topic"        value="$(arg scan_topic)"/>
    		<arg name="lidar_topic"       value="$(arg lidar_topic)"/>
                <arg name="imu_topic"         value="$(arg imu_topic)"/>
                <arg name="gps_topic"         value="$(arg gps_topic)" />
                <arg name="depth_topic"       value="$(arg depth_topic)" />
                <arg name="camera_topic"      value="$(arg camera_topic)" />
    		<arg name="map_file"          value="$(find go1_navigation)/maps/$(arg world_name).yaml" />
    		<arg name="mapping"           value="$(arg mapping)" />
    		<arg name="type"              value="$(arg type)" />
                <arg name="task_gui"          value="true" />
                <arg name="rviz_gui"          value="false" />
		<arg name="cmd_vel_topic"     value="/cmd_vel" />
		<arg name="launch_controller" value="false" />
                <arg name="launch_odometry"   value="false" /> <!-- Let's use Go1 odometry -->
		<arg name="target"            value="$(arg target)" />
                <arg name="nimbro_params"     value="$(arg nimbro_params)" />
	</include>
    </group>
    <!-- Launch navigation -->
    <group unless="$(arg nimbro)">
	    <include file="$(find wolf_navigation_utils)/launch/wolf_navigation.launch">
                <arg name="robot_name"        value="$(arg robot_name)"/>
                <arg name="robot_model"       value="go1"/>
		<arg name="robot_params"      value="$(find go1_navigation)/params"/>
		<arg name="world_name"        value="$(arg world_name)" />
    		<arg name="global_frame"      value="$(arg global_frame)"/>
    		<arg name="odom_frame"        value="$(arg odom_frame)"/>
    		<arg name="base_frame"        value="$(arg base_frame)"/>
    		<arg name="scan_topic"        value="$(arg scan_topic)"/>
    		<arg name="lidar_topic"       value="$(arg lidar_topic)"/>
                <arg name="imu_topic"         value="$(arg imu_topic)"/>
                <arg name="gps_topic"         value="$(arg gps_topic)" />
                <arg name="depth_topic"       value="$(arg depth_topic)" />
    		<arg name="map_file"          value="$(find go1_navigation)/maps/$(arg world_name).yaml" />
    		<arg name="mapping"           value="$(arg mapping)" />
    		<arg name="type"              value="$(arg type)" />
                <arg name="task_gui"          value="true" />
                <arg name="rviz_gui"          value="false" />
		<arg name="cmd_vel_topic"     value="/cmd_vel" />
		<arg name="launch_controller" value="false" />
                <arg name="launch_odometry"   value="false" /> <!-- Let's use Go1 odometry -->
	    </include>
     </group>

</launch>
